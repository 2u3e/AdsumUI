<!-- Backdrop Overlay -->
@if (isOpen) {
  <div
    class="fixed inset-0 bg-black/50 z-[100] transition-opacity duration-300"
    (click)="close()"
  ></div>
}

<!-- Offcanvas Panel - Slides from Right -->
@if (isOpen) {
  <div
    class="fixed top-0 right-0 h-full w-[85%] sm:w-[450px] bg-white dark:bg-gray-800 shadow-2xl z-[101] transform transition-transform duration-300 ease-out flex flex-col animate-slide-in-right"
  >
    <!-- Header -->
    <div
      class="flex items-center justify-between px-6 h-[72px] border-b border-gray-200 dark:border-gray-700 shrink-0"
    >
      <div class="flex items-center gap-3 flex-1">
        <div
          class="flex items-center justify-center w-10 h-10 rounded-lg bg-primary/10 dark:bg-primary/20 shrink-0"
        >
          <i class="ki-filled ki-filter text-xl text-primary"></i>
        </div>
        <div
          class="flex flex-col min-h-[40px] transition-all duration-300"
          [class.justify-center]="getActiveFilterCount() === 0"
          [class.justify-start]="getActiveFilterCount() > 0"
        >
          <h3
            class="text-lg font-semibold text-gray-900 dark:text-white leading-tight"
          >
            {{ config.title || "Filtreleme Seçenekleri" }}
          </h3>
          @if (getActiveFilterCount() > 0) {
            <p
              class="text-xs text-gray-500 dark:text-gray-400 mt-1 animate-slide-down"
            >
              {{ getActiveFilterCount() }} filtre aktif
            </p>
          }
        </div>
      </div>
      <button
        type="button"
        class="kt-btn kt-btn-sm kt-btn-icon kt-btn-ghost shrink-0"
        (click)="close()"
      >
        <i class="ki-filled ki-cross text-lg"></i>
      </button>
    </div>

    <!-- Filter Content - Scrollable -->
    <div class="flex-1 overflow-y-auto px-6 py-5">
      @if (config.fields) {
        <div class="space-y-5">
          @for (field of config.fields; track trackByKey($index, field)) {
            <div>
              <!-- Text Input -->
              @if (field.type === "text") {
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                >
                  {{ field.label }}
                  @if (field.required) {
                    <span class="text-red-500">*</span>
                  }
                </label>
                <input
                  type="text"
                  class="kt-input w-full"
                  [placeholder]="field.placeholder || ''"
                  [ngModel]="getFieldValue(field.key)"
                  (ngModelChange)="updateFilterValue(field.key, $event)"
                  [ngModelOptions]="{ standalone: true }"
                />
              }

              <!-- Number Input -->
              @if (field.type === "number") {
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                >
                  {{ field.label }}
                  @if (field.required) {
                    <span class="text-red-500">*</span>
                  }
                </label>
                <input
                  type="number"
                  class="kt-input w-full"
                  [placeholder]="field.placeholder || ''"
                  [ngModel]="getFieldValue(field.key)"
                  (ngModelChange)="updateFilterValue(field.key, $event)"
                  [ngModelOptions]="{ standalone: true }"
                />
              }

              <!-- Select Dropdown -->
              @if (field.type === "select") {
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                >
                  {{ field.label }}
                  @if (field.required) {
                    <span class="text-red-500">*</span>
                  }
                </label>
                <select
                  [id]="getFieldElementId(field)"
                  class="kt-select w-full text-sm"
                  data-kt-select="true"
                  [attr.data-kt-select-placeholder]="
                    field.placeholder || 'Seçiniz'
                  "
                  [attr.data-kt-select-config]="
                    '{&quot;optionsClass&quot;: &quot;kt-scrollable overflow-auto max-h-[250px]&quot;}'
                  "
                  [ngModel]="getFieldValue(field.key) ?? ''"
                  (ngModelChange)="onSelectChange(field, $event)"
                  [ngModelOptions]="{ standalone: true }"
                >
                  <option value=""></option>
                  @for (option of field.options; track option.id) {
                    <option [ngValue]="option.id">{{ option.name }}</option>
                  }
                </select>
              }

              <!-- Multi Select Dropdown -->
              @if (field.type === "multiselect") {
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                >
                  {{ field.label }}
                  @if (field.required) {
                    <span class="text-red-500">*</span>
                  }
                </label>
                <select
                  [id]="getFieldElementId(field)"
                  class="kt-select w-full text-sm"
                  data-kt-select="true"
                  data-kt-select-multiple="true"
                  [attr.data-kt-select-placeholder]="
                    field.placeholder || 'Seçiniz'
                  "
                  [attr.data-kt-select-config]="
                    '{&quot;optionsClass&quot;: &quot;kt-scrollable overflow-auto max-h-[250px]&quot;, &quot;displaySeparator&quot;: &quot;, &quot;}'
                  "
                  multiple
                  [ngModel]="getFieldValue(field.key) ?? []"
                  (ngModelChange)="onMultiSelectChange(field, $event)"
                  [ngModelOptions]="{ standalone: true }"
                >
                  @for (option of field.options; track option.id) {
                    <option [value]="option.id">{{ option.name }}</option>
                  }
                </select>
              }

              <!-- Radio Buttons -->
              @if (field.type === "radio") {
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                >
                  {{ field.label }}
                  @if (field.required) {
                    <span class="text-red-500">*</span>
                  }
                </label>
                <div class="flex flex-col gap-2">
                  @for (option of field.options; track option.id) {
                    <label class="flex items-center gap-2 cursor-pointer">
                      <input
                        type="radio"
                        class="kt-radio"
                        [name]="field.key"
                        [value]="option.id"
                        [ngModel]="getFieldValue(field.key)"
                        (ngModelChange)="updateFilterValue(field.key, $event)"
                        [ngModelOptions]="{ standalone: true }"
                      />
                      <span class="text-sm text-gray-700 dark:text-gray-300">
                        {{ option.name }}
                      </span>
                    </label>
                  }
                </div>
              }

              <!-- Checkbox -->
              @if (field.type === "checkbox") {
                <label class="flex items-center gap-2 cursor-pointer">
                  <input
                    type="checkbox"
                    class="kt-checkbox"
                    [ngModel]="getFieldValue(field.key)"
                    (ngModelChange)="updateFilterValue(field.key, $event)"
                    [ngModelOptions]="{ standalone: true }"
                  />
                  <span
                    class="text-sm font-medium text-gray-700 dark:text-gray-300"
                  >
                    {{ field.label }}
                    @if (field.required) {
                      <span class="text-red-500">*</span>
                    }
                  </span>
                </label>
              }

              <!-- Switch -->
              @if (field.type === "switch") {
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                >
                  {{ field.label }}
                  @if (field.required) {
                    <span class="text-red-500">*</span>
                  }
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                  <input
                    type="checkbox"
                    class="kt-switch"
                    [id]="'switch_' + field.key"
                    [ngModel]="getFieldValue(field.key)"
                    (ngModelChange)="updateFilterValue(field.key, $event)"
                    [ngModelOptions]="{ standalone: true }"
                  />
                  <span class="text-sm text-gray-700 dark:text-gray-300">
                    {{ getFieldValue(field.key) ? "Aktif" : "Pasif" }}
                  </span>
                </label>
              }

              <!-- Date Input -->
              @if (field.type === "date") {
                <label
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
                >
                  {{ field.label }}
                  @if (field.required) {
                    <span class="text-red-500">*</span>
                  }
                </label>
                <input
                  type="date"
                  class="kt-input w-full"
                  [ngModel]="getFieldValue(field.key)"
                  (ngModelChange)="updateFilterValue(field.key, $event)"
                  [ngModelOptions]="{ standalone: true }"
                />
              }
            </div>
          }
        </div>
      }
    </div>

    <!-- Footer Actions - Sticky -->
    <div
      class="flex gap-3 px-6 py-4 border-t border-gray-200 dark:border-gray-700 shrink-0 bg-white dark:bg-gray-800"
    >
      <button
        class="kt-btn flex-1 bg-red-50 hover:bg-red-100 text-red-700 hover:text-red-800 dark:bg-red-900/20 dark:hover:bg-red-900/30 dark:text-red-400 dark:hover:text-red-300 border border-red-200 dark:border-red-800 transition-all"
        (click)="clearFilters()"
        type="button"
      >
        <i class="ki-filled ki-trash text-base"></i>
        {{ getClearButtonText() }}
      </button>
      <button
        class="kt-btn kt-btn-primary flex-1"
        (click)="applyFilters()"
        type="button"
      >
        <i class="ki-filled ki-check text-base"></i>
        {{ getApplyButtonText() }}
      </button>
    </div>
  </div>
}
